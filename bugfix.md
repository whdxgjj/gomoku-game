# Gomoku Game Bugfix 项目

## 项目概述

本项目是基于 `gomoku-game` 的 bugfix 分支，用于修复和改进五子棋游戏中的问题。

## 已修复问题

### Issue #1: 代码质量问题

1. **模块导入/导出不匹配** (严重)
   - 问题: HTML 中使用 `<script type="module">` 但 game.js 未使用 ES 模块导出
   - 修复: 移除 `type="module"` 属性

2. **棋盘尺寸硬编码** (中等)
   - 问题: Canvas 尺寸在 HTML 中硬编码为 600
   - 修复: 在 JS 中动态计算并设置 canvas 尺寸

3. **响应式 Canvas 坐标系问题** (中等)
   - 问题: CSS 中 canvas 响应式缩放导致坐标系不一致
   - 修复: 移除响应式缩放，保持固定尺寸

4. **游戏结束后悔棋限制** (轻微)
   - 问题: 游戏结束后不允许悔棋
   - 修复: 允许悔棋并自动恢复游戏状态

5. **缺少输入验证** (轻微)
   - 问题: canvas 元素不存在时没有错误提示
   - 修复: 添加元素存在性检查和错误提示

## 待修复问题

### 1. 长连禁手规则未实现
- **位置**: `game.js:310`
- **问题**: 标准五子棋规则中，黑棋长连（超过 5 子）通常不算赢
- **优先级**: 中
- **计划**: 添加黑棋长连禁手规则，超过 5 子不算获胜

### 2. 魔法数字优化
- **位置**: 多处
  - 星位半径硬编码为 `4`
  - 棋子半径计算中的 `-3`
  - 最后一步标记半径 `4`
- **问题**: 代码可维护性差
- **优先级**: 低
- **计划**: 将魔法数字提取为命名常量

### 3. 性能优化
- **位置**: `game.js:231-232`
- **问题**: 每次落子都重绘整个棋盘
- **优先级**: 低
- **计划**: 考虑增量绘制，只重绘受影响区域

### 4. 键盘快捷键支持
- **问题**: 缺少键盘快捷键
- **优先级**: 低
- **计划**: 添加以下快捷键
  - `Ctrl+Z`: 撤销
  - `R`: 重新开始

### 5. 游戏状态持久化
- **问题**: 刷新页面后游戏状态丢失
- **优先级**: 低
- **计划**: 使用 localStorage 保存/加载游戏状态

## 修复计划

### 阶段一：核心规则完善
- [ ] 实现长连禁手规则
- [ ] 添加游戏配置选项（可切换规则）

### 阶段二：代码质量提升
- [ ] 提取魔法数字为常量
- [ ] 添加 TypeScript 类型支持（可选）
- [ ] 添加单元测试

### 阶段三：用户体验改进
- [ ] 添加键盘快捷键
- [ ] 实现游戏状态持久化
- [ ] 添加音效和动画

### 阶段四：性能优化
- [ ] 优化重绘逻辑
- [ ] 添加 AI 对手（可选）

## 分支说明

- `master`: 主分支，稳定版本
- `bugfix`: 修复分支，用于问题修复和改进

## 提交规范

```
类型(范围): 简短描述

详细描述（可选）

关闭的 Issue（可选）
```

类型：
- `fix`: 修复 bug
- `feat`: 新功能
- `refactor`: 重构代码
- `docs`: 文档更新
- `style`: 代码格式调整
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建/工具相关
